Feature: BRD Workflow # tests/features/brd_workflow.feature:1
  As a tester
  I want to work with Business Requirement Documents
  So that I can scope my API testing
  Feature: BRD Workflow  # tests/features/brd_workflow.feature:1

  Scenario: Generate BRD from Swagger with full coverage      # tests/features/brd_workflow.feature:10
    Given the system is initialized                           # tests/features/steps/main_workflow_steps.py:22
    And I have a processed Swagger schema                     # tests/features/steps/main_workflow_steps.py:89
    Given I have a Swagger schema with multiple endpoints     # tests/features/steps/main_workflow_steps.py:68
    When I generate a BRD from the Swagger schema             # tests/features/steps/brd_workflow_steps.py:68
    And I specify coverage percentage of "100"                # tests/features/steps/brd_workflow_steps.py:81
    Then a BRD should be created                              # tests/features/steps/brd_workflow_steps.py:126
    And the BRD should contain requirements for all endpoints # tests/features/steps/brd_workflow_steps.py:132
    And the BRD should be saved to the output directory       # None

  Scenario: Generate BRD from Swagger with partial coverage          # tests/features/brd_workflow.feature:18
    Given the system is initialized                                  # tests/features/steps/main_workflow_steps.py:22
    And I have a processed Swagger schema                            # tests/features/steps/main_workflow_steps.py:89
    Given I have a Swagger schema with multiple endpoints            # tests/features/steps/main_workflow_steps.py:68
    When I generate a BRD from the Swagger schema                    # tests/features/steps/brd_workflow_steps.py:68
    And I specify coverage percentage of "50"                        # tests/features/steps/brd_workflow_steps.py:81
    Then a BRD should be created                                     # tests/features/steps/brd_workflow_steps.py:126
    And the BRD should prioritize critical endpoints                 # tests/features/steps/brd_workflow_steps.py:139
    And the BRD should cover approximately "50" percent of endpoints # tests/features/steps/brd_workflow_steps.py:146

  Scenario: Validate BRD against Swagger schema        # tests/features/brd_workflow.feature:26
    Given the system is initialized                    # tests/features/steps/main_workflow_steps.py:22
    And I have a processed Swagger schema              # tests/features/steps/main_workflow_steps.py:89
    Given I have a BRD schema                          # tests/features/steps/brd_workflow_steps.py:15
    And I have a Swagger schema                        # tests/features/steps/brd_workflow_steps.py:30
    When I validate the BRD against the Swagger schema # tests/features/steps/brd_workflow_steps.py:87
    Then validation should complete                    # tests/features/steps/brd_workflow_steps.py:154
    And orphaned endpoints should be identified        # tests/features/steps/brd_workflow_steps.py:160
    And missing endpoints should be identified         # tests/features/steps/brd_workflow_steps.py:166
    And a validation report should be generated        # tests/features/steps/brd_workflow_steps.py:172

  Scenario: Cross-reference BRD with Swagger               # tests/features/brd_workflow.feature:35
    Given the system is initialized                        # tests/features/steps/main_workflow_steps.py:22
    And I have a processed Swagger schema                  # tests/features/steps/main_workflow_steps.py:89
    Given I have a BRD schema                              # tests/features/steps/brd_workflow_steps.py:15
    And I have a Swagger schema analysis                   # tests/features/steps/brd_workflow_steps.py:42
    When I cross-reference the BRD with the Swagger schema # tests/features/steps/brd_workflow_steps.py:96
    Then endpoints should be filtered by BRD coverage      # tests/features/steps/brd_workflow_steps.py:179
    And coverage percentage should be calculated           # tests/features/steps/brd_workflow_steps.py:185
    And a coverage report should be generated              # tests/features/steps/brd_workflow_steps.py:192

  Scenario: Load BRD from file                             # tests/features/brd_workflow.feature:43
    Given the system is initialized                        # tests/features/steps/main_workflow_steps.py:22
    And I have a processed Swagger schema                  # tests/features/steps/main_workflow_steps.py:89
    Given I have a BRD schema file in the output directory # tests/features/steps/brd_workflow_steps.py:54
    When I load the BRD from file                          # tests/features/steps/brd_workflow_steps.py:108
    Then the BRD should be loaded successfully             # tests/features/steps/brd_workflow_steps.py:198
    And the BRD structure should be valid                  # tests/features/steps/brd_workflow_steps.py:204
    And requirements should be accessible                  # tests/features/steps/brd_workflow_steps.py:211

  Scenario: Parse BRD from text document            # tests/features/brd_workflow.feature:50
    Given the system is initialized                 # tests/features/steps/main_workflow_steps.py:22
    And I have a processed Swagger schema           # tests/features/steps/main_workflow_steps.py:89
    Given I have a BRD text document                # tests/features/steps/brd_workflow_steps.py:61
    When I parse the BRD document                   # tests/features/steps/brd_workflow_steps.py:117
    Then the document should be parsed successfully # tests/features/steps/brd_workflow_steps.py:218
    And a BRD schema should be created              # tests/features/steps/brd_workflow_steps.py:224
    And requirements should be extracted            # tests/features/steps/brd_workflow_steps.py:230

Feature: Main Workflow - API Test Scenario Generation # tests/features/main_workflow.feature:1
  As a user
  I want to generate test scenarios from Swagger schemas
  So that I can test my API endpoints with proper coverage
  Feature: Main Workflow - API Test Scenario Generation  # tests/features/main_workflow.feature:1

  Scenario: Generate test scenarios with schema URL input                       # tests/features/main_workflow.feature:10
    Given the system is initialized                                             # tests/features/steps/main_workflow_steps.py:22
    And I have a valid OpenAI API key configured                                # tests/features/steps/main_workflow_steps.py:34
    Given I provide a Swagger schema URL "https://api.weather.gov/openapi.json" # tests/features/steps/main_workflow_steps.py:49
    When I run the main workflow                                                # tests/features/steps/main_workflow_steps.py:103
    And I choose to generate BRD from Swagger                                   # tests/features/steps/main_workflow_steps.py:132
    And I specify coverage percentage of "100"                                  # tests/features/steps/brd_workflow_steps.py:81
    Then the schema should be downloaded successfully                           # tests/features/steps/schema_processing_steps.py:92
    And the schema should be processed                                          # tests/features/steps/main_workflow_steps.py:179
    And the schema should be analyzed                                           # tests/features/steps/main_workflow_steps.py:186
    And a BRD should be generated                                               # tests/features/steps/main_workflow_steps.py:193
    And BRD should be validated against the schema                              # tests/features/steps/main_workflow_steps.py:204
    And endpoints should be cross-referenced                                    # tests/features/steps/main_workflow_steps.py:214
    And Gherkin scenarios should be generated                                   # tests/features/steps/main_workflow_steps.py:223
    And CSV file should be created                                              # tests/features/steps/main_workflow_steps.py:232
    And analytics reports should be generated                                   # tests/features/steps/main_workflow_steps.py:241

  Scenario: Load existing BRD schema file                                       # tests/features/main_workflow.feature:25
    Given the system is initialized                                             # tests/features/steps/main_workflow_steps.py:22
    And I have a valid OpenAI API key configured                                # tests/features/steps/main_workflow_steps.py:34
    Given I provide a Swagger schema URL "https://api.weather.gov/openapi.json" # tests/features/steps/main_workflow_steps.py:49
    When I run the main workflow                                                # tests/features/steps/main_workflow_steps.py:103
    And I choose to load existing BRD schema                                    # tests/features/steps/main_workflow_steps.py:138
    And I select BRD file "weather_gov_api_brd"                                 # tests/features/steps/main_workflow_steps.py:153
    Then the BRD should be loaded successfully                                  # tests/features/steps/brd_workflow_steps.py:198
    And BRD should be validated against the schema                              # tests/features/steps/main_workflow_steps.py:204
    And endpoints should be cross-referenced                                    # tests/features/steps/main_workflow_steps.py:214
    And Gherkin scenarios should be generated                                   # tests/features/steps/main_workflow_steps.py:223

  Scenario: Parse BRD from document                                             # tests/features/main_workflow.feature:35
    Given the system is initialized                                             # tests/features/steps/main_workflow_steps.py:22
    And I have a valid OpenAI API key configured                                # tests/features/steps/main_workflow_steps.py:34
    Given I provide a Swagger schema URL "https://api.weather.gov/openapi.json" # tests/features/steps/main_workflow_steps.py:49
    And I have a BRD document "test_brd.txt" in the input directory             # tests/features/steps/main_workflow_steps.py:103
    When I run the main workflow                                                # tests/features/steps/main_workflow_steps.py:144
    And I choose to parse BRD from document                                     # tests/features/steps/main_workflow_steps.py:204
    And I select document "test_brd.txt"                                        # tests/features/steps/main_workflow_steps.py:214
    Then the BRD document should be parsed successfully                         # None
    And BRD should be validated against the schema                              # None
    And endpoints should be cross-referenced                                    # None

  Scenario: Generate test scenarios with custom coverage percentage             # tests/features/main_workflow.feature:45
    Given the system is initialized                                             # tests/features/steps/main_workflow_steps.py:22
    And I have a valid OpenAI API key configured                                # tests/features/steps/main_workflow_steps.py:34
    Given I provide a Swagger schema URL "https://api.weather.gov/openapi.json" # tests/features/steps/main_workflow_steps.py:49
    When I run the main workflow                                                # tests/features/steps/main_workflow_steps.py:103
    And I choose to generate BRD from Swagger                                   # tests/features/steps/main_workflow_steps.py:132
    And I specify coverage percentage of "50"                                   # tests/features/steps/brd_workflow_steps.py:81
    Then the BRD should cover approximately "50" percent of endpoints           # tests/features/steps/brd_workflow_steps.py:146
    And only covered endpoints should be tested                                 # tests/features/steps/main_workflow_steps.py:265

  Scenario: Handle missing API key gracefully             # tests/features/main_workflow.feature:53
    Given the system is initialized                       # tests/features/steps/main_workflow_steps.py:22
    And I have a valid OpenAI API key configured          # tests/features/steps/main_workflow_steps.py:34
    Given I do not have a valid OpenAI API key configured # tests/features/steps/main_workflow_steps.py:41
    When I run the main workflow                          # tests/features/steps/main_workflow_steps.py:103
    Then the system should display an error message       # tests/features/steps/main_workflow_steps.py:249
    And the workflow should exit gracefully               # tests/features/steps/main_workflow_steps.py:255

  Scenario: Handle invalid schema URL                                                   # tests/features/main_workflow.feature:59
    Given the system is initialized                                                     # tests/features/steps/main_workflow_steps.py:22
    And I have a valid OpenAI API key configured                                        # tests/features/steps/main_workflow_steps.py:34
    Given I provide an invalid Swagger schema URL "https://invalid-url.com/schema.json" # tests/features/steps/main_workflow_steps.py:55
    When I run the main workflow                                                        # tests/features/steps/main_workflow_steps.py:103
    Then the system should display an error message                                     # tests/features/steps/main_workflow_steps.py:249
    And the workflow should exit gracefully                                             # tests/features/steps/main_workflow_steps.py:255

  Scenario: Handle empty URL input                  # tests/features/main_workflow.feature:65
    Given the system is initialized                 # tests/features/steps/main_workflow_steps.py:22
    And I have a valid OpenAI API key configured    # tests/features/steps/main_workflow_steps.py:34
    Given I provide an empty schema URL             # tests/features/steps/main_workflow_steps.py:62
    When I run the main workflow                    # tests/features/steps/main_workflow_steps.py:103
    Then the system should display an error message # tests/features/steps/main_workflow_steps.py:249
    And the workflow should exit gracefully         # tests/features/steps/main_workflow_steps.py:255

Feature: Schema Processing # tests/features/schema_processing.feature:1
  As a developer
  I want to process and analyze Swagger schemas
  So that I can understand the API structure
  Feature: Schema Processing  # tests/features/schema_processing.feature:1

  Scenario: Download and validate Swagger 2.0 schema          # tests/features/schema_processing.feature:9
    Given the system is initialized                           # tests/features/steps/main_workflow_steps.py:22
    Given I have a Swagger 2.0 schema URL                     # tests/features/steps/schema_processing_steps.py:16
    When I download the schema for processing                 # tests/features/steps/schema_processing_steps.py:55
    Then the schema should be downloaded successfully         # tests/features/steps/schema_processing_steps.py:92
    And the schema format should be detected as "Swagger 2.0" # tests/features/steps/schema_processing_steps.py:98
    And the schema should be saved to the schemas directory   # tests/features/steps/schema_processing_steps.py:105

  Scenario: Download and validate OpenAPI 3.0 schema          # tests/features/schema_processing.feature:16
    Given the system is initialized                           # tests/features/steps/main_workflow_steps.py:22
    Given I have an OpenAPI 3.0 schema URL                    # tests/features/steps/schema_processing_steps.py:23
    When I download the schema for processing                 # tests/features/steps/schema_processing_steps.py:55
    Then the schema should be downloaded successfully         # tests/features/steps/schema_processing_steps.py:92
    And the schema format should be detected as "OpenAPI 3.0" # tests/features/steps/schema_processing_steps.py:98
    And the schema should be saved to the schemas directory   # tests/features/steps/schema_processing_steps.py:105

  Scenario: Process schema and extract endpoints     # tests/features/schema_processing.feature:23
    Given the system is initialized                  # tests/features/steps/main_workflow_steps.py:22
    Given I have a downloaded schema file            # tests/features/steps/schema_processing_steps.py:30
    When I process the schema                        # tests/features/steps/schema_processing_steps.py:78
    Then the schema should be processed successfully # tests/features/steps/schema_processing_steps.py:112
    And endpoints should be extracted                # tests/features/steps/schema_processing_steps.py:119
    And endpoint count should be greater than zero   # None

  Scenario: Analyze schema for test traceability   # tests/features/schema_processing.feature:30
    Given the system is initialized                # tests/features/steps/main_workflow_steps.py:22
    Given I have a processed schema                # tests/features/steps/schema_processing_steps.py:43
    When I analyze the schema                      # tests/features/steps/schema_processing_steps.py:85
    Then the analysis should complete successfully # tests/features/steps/schema_processing_steps.py:128
    And complexity metrics should be calculated    # tests/features/steps/schema_processing_steps.py:134
    And parameter information should be extracted  # tests/features/steps/schema_processing_steps.py:141

